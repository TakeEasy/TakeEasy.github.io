---
title: 某学城项目(3)
date: 2024-07-22 09:45:53
top_img: 'img/12.png'
cover: 'img/12.png'
categories:
  - Django
tags:
  - django-rest-framework
  - Django
  - 环境配置
---


------
# 前端基本搭建和Git管控代码

## 头部组件
- 导航条每个页面都有 固定 在components 目录下添加Head.vue
    ```vue
    <template>
        <div class="header">
            <div class="slogan">
                <p>老男孩IT教育 | 帮助有志向的年轻人通过努力学习获得体面的工作和生活</p>
            </div>
            <div class="nav">
                <ul class="left-part">
                    <li class="logo">
                        <router-link to="/">
                            <img src="../assets/img/head-logo.svg" alt="">
                        </router-link>
                    </li>
                    <li class="ele">
                        <span @click="goPage('/free-course')" :class="{active: url_path === '/free-course'}">免费课</span>
                    </li>
                    <li class="ele">
                        <span @click="goPage('/actual-course')" :class="{active: url_path === '/actual-course'}">实战课</span>
                    </li>
                    <li class="ele">
                        <span @click="goPage('/light-course')" :class="{active: url_path === '/light-course'}">轻课</span>
                    </li>
                </ul>

                <div class="right-part">
                    <div>
                        <span>登录</span>
                        <span class="line">|</span>
                        <span>注册</span>
                    </div>
                </div>
            </div>
        </div>

    </template>

    <script>

        export default {
            name: "Header",
            data() {
                return {
                    url_path: sessionStorage.url_path || '/',
                }
            },
            methods: {
                goPage(url_path) {
                    // 传入的路由如果不是当前所在路径，就跳转
                    if (this.url_path !== url_path) {
                        this.$router.push(url_path);
                    }
                    sessionStorage.url_path = url_path;
                },
            },
            created() {
                sessionStorage.url_path = this.$route.path;
                this.url_path = this.$route.path;
            }
        }
    </script>

    <style scoped>
        .header {
            background-color: white;
            box-shadow: 0 0 5px 0 #aaa;
        }

        .header:after {
            content: "";
            display: block;
            clear: both;
        }

        .slogan {
            background-color: #eee;
            height: 40px;
        }

        .slogan p {
            width: 1200px;
            margin: 0 auto;
            color: #aaa;
            font-size: 13px;
            line-height: 40px;
        }

        .nav {
            background-color: white;
            user-select: none;
            width: 1200px;
            margin: 0 auto;

        }

        .nav ul {
            padding: 15px 0;
            float: left;
        }

        .nav ul:after {
            clear: both;
            content: '';
            display: block;
        }

        .nav ul li {
            float: left;
        }

        .logo {
            margin-right: 20px;
        }

        .ele {
            margin: 0 20px;
        }

        .ele span {
            display: block;
            font: 15px/36px '微软雅黑';
            border-bottom: 2px solid transparent;
            cursor: pointer;
        }

        .ele span:hover {
            border-bottom-color: orange;
        }

        .ele span.active {
            color: orange;
            border-bottom-color: orange;
        }

        .right-part {
            float: right;
        }

        .right-part .line {
            margin: 0 10px;
        }

        .right-part span {
            line-height: 68px;
            cursor: pointer;
        }
    </style>
    ```

## 尾部组件
- 尾部组件同样每个页面都有 在components目录下添加Footer.vue
    ```vue
    <template>
        <div class="footer">
            <ul>
                <li>关于我们</li>
                <li>联系我们</li>
                <li>商务合作</li>
                <li>帮助中心</li>
                <li>意见反馈</li>
                <li>新手指南</li>
            </ul>
            <p>Copyright © luffycity.com版权所有 | 京ICP备17072161号-1</p>
        </div>
    </template>

    <script>
        export default {
            name: "Footer"
        }
    </script>

    <style scoped>
        .footer {
            width: 100%;
            height: 128px;
            background: #25292e;
            color: #fff;
        }

        .footer ul {
            margin: 0 auto 16px;
            padding-top: 38px;
            width: 810px;
        }

        .footer ul li {
            float: left;
            width: 112px;
            margin: 0 10px;
            text-align: center;
            font-size: 14px;
        }

        .footer ul::after {
            content: "";
            display: block;
            clear: both;
        }

        .footer p {
            text-align: center;
            font-size: 12px;
        }
    </style>
    ```

## 轮播图组件
- 首页轮播图 用elementui里的跑马灯 在components目录下添加Banner.vue
    ```vue
    <template>
        <div name="banner" class="block text-center">
        <el-carousel height="auto" :autoplay="false" v-if="banner_list[0]">
        <el-carousel-item v-for="item in banner_list">
            <!-- <h3 class="small justify-center" text="2xl">{{ item }}</h3> -->
            <!-- <img src="../assets/img/banner1.png"> -->
            <RouterLink :to="item.link">
                <img :src="item.img" :alt="item.name">
            </RouterLink>
        </el-carousel-item>
        </el-carousel>
    </div>
    </template>

    <script>
    import {inject} from 'vue'


    export default {
        name: "Banner",
        data(){
            return {
                banner_list:[],
            }
        },
        created(){
            const $settings=inject("$settings")
            //当banner组件一创建 就向后端发请求 拿轮播图数据
            this.axios.get($settings.base_url+'/home/banner/').then(response=>{
                console.log(response.data)
                this.banner_list=response.data
            }).catch(error=>{})
            
        },
    }
    </script>

    <style scoped>
    .demonstration {
    color: var(--el-text-color-secondary);
    }

    /* .el-carousel__item h3 {
    color: #475669;
    opacity: 0.75;
    line-height: 600px;
    margin: 0;
    text-align: center;
    } */

    .el-carousel__item {
            height: 800px;
            min-width: 1200px;
        }

    .el-carousel__item img {
        height: 800px;
        /*margin-left: 20px;*/
        margin-left: calc(50% - 3840px / 2);
    }

    /* .el-carousel__item:nth-child(2n) {
    background-color: #99a9bf;
    }

    .el-carousel__item:nth-child(2n + 1) {
    background-color: #d3dce6;
    } */
    </style>
    ```
- 展示哪些图片 展示多少 我们通过ajax去后端数据库取 所以先在homeapp里操作
```Python
# 将每个表都要有的字段 我们抽象出来 放到utils下luffymodels.py 里
from django.db import models

class BaseModel(models.Model):
    create_time = models.DateTimeField(auto_now_add=True, verbose_name='创建时间')
    update_time = models.DateTimeField(auto_now=True, create_time='最后更新时间')
    is_delete = models.BooleanField(default=False, verbose_name='是否删除')
    is_show = models.BooleanField(default=True, verbose_name='是否展示')
    display_order = models.IntegerField(verbose_name='展示顺序')

    class Meta:
        abstract = True

# 回到home app下的models.py创建表
from luffyapi.utils.luffymodels import BaseModel

class Banner(BaseModel):
    img = models.ImageField(verbose_name='轮播图片', help_text='图片尺寸必须是:3840*800')
    link = models.CharField(max_length=64, verbose_name='跳转链接')
    info = models.TextField(verbose_name='图片简介')

# 到home app目录下创建drf序列化器 ser.py
from rest_framework import serializers
from . import models


class BannerModelSerializer(serializers.ModelSerializer):
    class Meta:
        model = models.Banner
        fields = ['name', 'link', 'img']

# 到Views里根据需要的接口选择相应的drfView继承使用
from rest_framework.views import APIView
from rest_framework.mixins import ListModelMixin
from rest_framework.generics import GenericAPIView, ListAPIView
from luffyapi.utils.luffylogger import luffy_logger
from luffyapi.utils.luffyresponse import LuffyResponse
from . import models
from . import ser


class BannerView(ListAPIView):
    queryset = models.Banner.objects.filter(is_delete=False, is_show=True).order_by('display_order')[
               :settings.BANNER_COUNTER]  # 可以通过settings 里的配置 来控制轮播图的展示数量
    serializer_class = ser.BannerModelSerializer
class BannerViewSet(GenericViewSet, ListModelMixin): # 使用ViewSet 
    queryset = models.Banner.objects.filter(is_delete=False, is_show=True).order_by('display_order')[
               :settings.BANNER_COUNTER]
    serializer_class = ser.BannerModelSerializer

# 根据继承的View使用不同的路由配置方法 urls.py
from django.urls import path, re_path, include
from rest_framework.routers import SimpleRouter
from . import views

router = SimpleRouter()
router.register('banner2', views.BannerViewSet, 'banner2')

urlpatterns = [
    path('banner/', views.BannerView.as_view()),
    # path('banner2/', views.BannerViewSet.as_view({'get': 'list'})) 这是另一种配置方法
]
urlpatterns += router.urls

```
- 用 axios在created生命周期的时候去后端获取banner数据
- **会遇到跑马灯第一页不显示的问题** 要在跑马灯组件加个v-if判断 等banner_list有值了再开始渲染 代码参照上面banner.vue

## Git的使用
- 哈哈哈哈 不想聊 看[git教程](https://www.liaoxuefeng.com/wiki/896043488029600)

## 首页登录注册模态框
- 添加Login组件到components目录下
    ```javascript
    <template>
        <div class="login">
            <div class="box">
                <i class="el-icon-close" @click="close_login"></i>
                <div class="content">
                    <div class="nav">
                        <span :class="{active: login_method === 'is_pwd'}"
                            @click="change_login_method('is_pwd')">密码登录</span>
                        <span :class="{active: login_method === 'is_sms'}"
                            @click="change_login_method('is_sms')">短信登录</span>
                    </div>
                    <el-form v-if="login_method === 'is_pwd'">
                        <el-input
                                placeholder="用户名/手机号/邮箱"
                                prefix-icon="el-icon-user"
                                v-model="username"
                                clearable>
                        </el-input>
                        <el-input
                                placeholder="密码"
                                prefix-icon="el-icon-key"
                                v-model="password"
                                clearable
                                show-password>
                        </el-input>
                        <el-button type="primary" @click="login_password">登录</el-button>
                    </el-form>
                    <el-form v-if="login_method === 'is_sms'">
                        <el-input
                                placeholder="手机号"
                                prefix-icon="el-icon-phone-outline"
                                v-model="mobile"
                                clearable
                                @blur="check_mobile">
                        </el-input>
                        <el-input
                                placeholder="验证码"
                                prefix-icon="el-icon-chat-line-round"
                                v-model="sms"
                                clearable>
                            <template slot="append">
                                <span class="sms" @click="send_sms">{{ sms_interval }}</span>
                            </template>
                        </el-input>
                        <el-button type="primary">登录</el-button>
                    </el-form>
                    <div class="foot">
                        <span @click="go_register">立即注册</span>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <script>
        export default {
            name: "Login",
            data() {
                return {
                    username: '',
                    password: '',
                    mobile: '',
                    sms: '',
                    login_method: 'is_pwd',
                    sms_interval: '获取验证码',
                    is_send: false,
                }
            },
            methods: {
                close_login() {
                    this.$emit('close')
                },
                go_register() {
                    this.$emit('go')
                },
                change_login_method(method) {
                    this.login_method = method;
                },
                check_mobile() {
                    if (!this.mobile) return;
                    if (!this.mobile.match(/^1[3-9][0-9]{9}$/)) {
                        this.$message({
                            message: '手机号有误',
                            type: 'warning',
                            duration: 1000,
                            onClose: () => {
                                this.mobile = '';
                            }
                        });
                        return false;
                    }
                    this.is_send = true;
                },
                send_sms() {

                    if (!this.is_send) return;
                    this.is_send = false;
                    let sms_interval_time = 60;
                    this.sms_interval = "发送中...";
                    let timer = setInterval(() => {
                        if (sms_interval_time <= 1) {
                            clearInterval(timer);
                            this.sms_interval = "获取验证码";
                            this.is_send = true; // 重新回复点击发送功能的条件
                        } else {
                            sms_interval_time -= 1;
                            this.sms_interval = `${sms_interval_time}秒后再发`;
                        }
                    }, 1000);
                },

                login_password() {
                    if (this.username && this.password) {
                        //发送请求
                        this.axios.post(this.$settings.base_url + '/user/login/', {
                            username: this.username,
                            password: this.password


                        }).then(response => {
                            console.log(response.data)
                            //把用户信息保存到cookie中
                            // this.$cookies.set('key','value','过期时间,按s计')
                            this.$cookies.set('token',response.data.token,'7d')
                            this.$cookies.set('username',response.data.username,'7d')
                            //关闭登录窗口(子传父)
                            this.$emit('close')
                            //给父组件，Head传递一个事件，让它从cookie中取出token和username
                            this.$emit('loginsuccess')
                        }).catch(errors => {
                        })
                    } else {
                        this.$message({
                            message: '用户名或密码必须填哦',
                            type: 'warning',

                        });
                    }
                },
            }
        }
    </script>

    <style scoped>
        .login {
            width: 100vw;
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 10;
            background-color: rgba(0, 0, 0, 0.3);
        }

        .box {
            width: 400px;
            height: 420px;
            background-color: white;
            border-radius: 10px;
            position: relative;
            top: calc(50vh - 210px);
            left: calc(50vw - 200px);
        }

        .el-icon-close {
            position: absolute;
            font-weight: bold;
            font-size: 20px;
            top: 10px;
            right: 10px;
            cursor: pointer;
        }

        .el-icon-close:hover {
            color: darkred;
        }

        .content {
            position: absolute;
            top: 40px;
            width: 280px;
            left: 60px;
        }

        .nav {
            font-size: 20px;
            height: 38px;
            border-bottom: 2px solid darkgrey;
        }

        .nav > span {
            margin: 0 20px 0 35px;
            color: darkgrey;
            user-select: none;
            cursor: pointer;
            padding-bottom: 10px;
            border-bottom: 2px solid darkgrey;
        }

        .nav > span.active {
            color: black;
            border-bottom: 3px solid black;
            padding-bottom: 9px;
        }

        .el-input, .el-button {
            margin-top: 40px;
        }

        .el-button {
            width: 100%;
            font-size: 18px;
        }

        .foot > span {
            float: right;
            margin-top: 20px;
            color: orange;
            cursor: pointer;
        }

        .sms {
            color: orange;
            cursor: pointer;
            display: inline-block;
            width: 70px;
            text-align: center;
            user-select: none;
        }
    </style>
    ```
- 添加Register组件到components目录下
    ```javascript
    <template>
        <div class="register">
            <div class="box">
                <i class="el-icon-close" @click="close_register"></i>
                <div class="content">
                    <div class="nav">
                        <span class="active">新用户注册</span>
                    </div>
                    <el-form>
                        <el-input
                                placeholder="手机号"
                                prefix-icon="el-icon-phone-outline"
                                v-model="mobile"
                                clearable
                                @blur="check_mobile">
                        </el-input>
                        <el-input
                                placeholder="密码"
                                prefix-icon="el-icon-key"
                                v-model="password"
                                clearable
                                show-password>
                        </el-input>
                        <el-input
                                placeholder="验证码"
                                prefix-icon="el-icon-chat-line-round"
                                v-model="sms"
                                clearable>
                            <template slot="append">
                                <span class="sms" @click="send_sms">{{ sms_interval }}</span>
                            </template>
                        </el-input>
                        <el-button type="primary">注册</el-button>
                    </el-form>
                    <div class="foot">
                        <span @click="go_login">立即登录</span>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <script>
        export default {
            name: "Register",
            data() {
                return {
                    mobile: '',
                    password: '',
                    sms: '',
                    sms_interval: '获取验证码',
                    is_send: false,
                }
            },
            methods: {
                close_register() {
                    this.$emit('close', false)
                },
                go_login() {
                    this.$emit('go')
                },
                check_mobile() {
                    if (!this.mobile) return;
                    if (!this.mobile.match(/^1[3-9][0-9]{9}$/)) {
                        this.$message({
                            message: '手机号有误',
                            type: 'warning',
                            duration: 1000,
                            onClose: () => {
                                this.mobile = '';
                            }
                        });
                        return false;
                    }
                    this.is_send = true;
                },
                send_sms() {
                    if (!this.is_send) return;
                    this.is_send = false;
                    let sms_interval_time = 60;
                    this.sms_interval = "发送中...";
                    let timer = setInterval(() => {
                        if (sms_interval_time <= 1) {
                            clearInterval(timer);
                            this.sms_interval = "获取验证码";
                            this.is_send = true; // 重新回复点击发送功能的条件
                        } else {
                            sms_interval_time -= 1;
                            this.sms_interval = `${sms_interval_time}秒后再发`;
                        }
                    }, 1000);
                }
            }
        }
    </script>

    <style scoped>
        .register {
            width: 100vw;
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 10;
            background-color: rgba(0, 0, 0, 0.3);
        }

        .box {
            width: 400px;
            height: 480px;
            background-color: white;
            border-radius: 10px;
            position: relative;
            top: calc(50vh - 240px);
            left: calc(50vw - 200px);
        }

        .el-icon-close {
            position: absolute;
            font-weight: bold;
            font-size: 20px;
            top: 10px;
            right: 10px;
            cursor: pointer;
        }

        .el-icon-close:hover {
            color: darkred;
        }

        .content {
            position: absolute;
            top: 40px;
            width: 280px;
            left: 60px;
        }

        .nav {
            font-size: 20px;
            height: 38px;
            border-bottom: 2px solid darkgrey;
        }

        .nav > span {
            margin-left: 90px;
            color: darkgrey;
            user-select: none;
            cursor: pointer;
            padding-bottom: 10px;
            border-bottom: 2px solid darkgrey;
        }

        .nav > span.active {
            color: black;
            border-bottom: 3px solid black;
            padding-bottom: 9px;
        }

        .el-input, .el-button {
            margin-top: 40px;
        }

        .el-button {
            width: 100%;
            font-size: 18px;
        }

        .foot > span {
            float: right;
            margin-top: 20px;
            color: orange;
            cursor: pointer;
        }

        .sms {
            color: orange;
            cursor: pointer;
            display: inline-block;
            width: 70px;
            text-align: center;
            user-select: none;
        }
    </style>
    ```
- 最后 在Head组件里 修改点东西 让他们可以点击显示 还有登陆后 显示用户名
    ```javascript
    <template>
        <div class="header">
            <div class="slogan">
                <p>老男孩IT教育 | 帮助有志向的年轻人通过努力学习获得体面的工作和生活</p>
            </div>
            <div class="nav">
                <ul class="left-part">
                    <li class="logo">
                        <router-link to="/">
                            <img src="../assets/img/head-logo.svg" alt="">
                        </router-link>
                    </li>
                    <li class="ele">
                        <span @click="goPage('/free-course')" :class="{active: url_path === '/free-course'}">免费课</span>
                    </li>
                    <li class="ele">
                        <span @click="goPage('/actual-course')" :class="{active: url_path === '/actual-course'}">实战课</span>
                    </li>
                    <li class="ele">
                        <span @click="goPage('/light-course')" :class="{active: url_path === '/light-course'}">轻课</span>
                    </li>
                </ul>

                <div class="right-part">
                    <div v-if="!username">
                        <span @click="put_login">登录</span>
                        <span class="line">|</span>
                        <span @click="put_register">注册</span>
                    </div>
                    <div v-else>
                        <span >{{username}}</span>
                        <span class="line">|</span>
                        <span @click="logout">注销</span>
                    </div>
                </div>
                <Login v-if="is_login" @close="close_login" @go="put_register" @loginsuccess="login_success"/>
                <Register v-if="is_register" @close="close_register" @go="put_login"/>
            </div>
        </div>

    </template>

    <script>
        import Login from './Login'
        import Register from './Register'

        export default {
            name: "Header",
            data() {
                return {
                    url_path: sessionStorage.url_path || '/',
                    is_login: false,
                    is_register: false,
                    token: '',
                    username: ''
                }
            },
            methods: {
                goPage(url_path) {
                    // 传入的路由如果不是当前所在路径，就跳转
                    if (this.url_path !== url_path) {
                        this.$router.push(url_path);
                    }
                    sessionStorage.url_path = url_path;
                },
                put_login() {
                    this.is_login = true;
                    this.is_register = false;
                },
                put_register() {
                    this.is_login = false;
                    this.is_register = true;
                },
                close_login() {
                    this.is_login = false;
                },
                close_register() {
                    this.is_register = false;
                },
                login_success(){
                    this.username=this.$cookies.get('username')
                    this.token=this.$cookies.get('token')
                },
                logout(){
                    //清除cookie
                    this.$cookies.remove('token')
                    this.$cookies.remove('username')
                    //把两个变量值为空
                    this.username=''
                    this.token=''
                },
            },
            created() {
                sessionStorage.url_path = this.$route.path;
                this.url_path = this.$route.path;

                //当页面一创建，我就去cookie中取token和username
                this.username = this.$cookies.get('username')   //取到就有值，取不到就为空
                this.token = this.$cookies.get('token')   //取到就有值，取不到就为空
            },
            components: {
                Login,
                Register
            }


        }
    </script>

    <style scoped>
        .header {
            background-color: white;
            box-shadow: 0 0 5px 0 #aaa;
        }

        .header:after {
            content: "";
            display: block;
            clear: both;
        }

        .slogan {
            background-color: #eee;
            height: 40px;
        }

        .slogan p {
            width: 1200px;
            margin: 0 auto;
            color: #aaa;
            font-size: 13px;
            line-height: 40px;
        }

        .nav {
            background-color: white;
            user-select: none;
            width: 1200px;
            margin: 0 auto;

        }

        .nav ul {
            padding: 15px 0;
            float: left;
        }

        .nav ul:after {
            clear: both;
            content: '';
            display: block;
        }

        .nav ul li {
            float: left;
        }

        .logo {
            margin-right: 20px;
        }

        .ele {
            margin: 0 20px;
        }

        .ele span {
            display: block;
            font: 15px/36px '微软雅黑';
            border-bottom: 2px solid transparent;
            cursor: pointer;
        }

        .ele span:hover {
            border-bottom-color: orange;
        }

        .ele span.active {
            color: orange;
            border-bottom-color: orange;
        }

        .right-part {
            float: right;
        }

        .right-part .line {
            margin: 0 10px;
        }

        .right-part span {
            line-height: 68px;
            cursor: pointer;
        }
    </style>
    ```

## 登录注册后端接口
- 多方式登录接口
  1. 在User app下创建ser.py创建drf序列化类
    ```Python
    from rest_framework import serializers
    from rest_framework.exceptions import ValidationError
    from rest_framework_jwt.utils import jwt_payload_handler, jwt_encode_handler
    from . import models


    class UserModelSerializer(serializers.ModelSerializer):
        username = serializers.CharField()

        class Meta:
            model = models.User
            fields = ['username', 'password', 'id']
            extra_kwargs = {
                'id': {'read_only': True},
                'password': {'write_only': True}
            }

        def validate(self, attrs):
            user = self._get_user(attrs)
            # 签发token
            token = self._get_token(user)
            # 放入context views中可以取出
            self.context['token'] = token
            self.context['user'] = user
            return attrs

        def _get_user(self, attrs):
            username = attrs.get('username')
            password = attrs.get('password')

            # 多种登录方式
            import re
            if re.match('^1[3-9][0-9]{9}$', username):
                user = models.User.objects.filter(phone=username).first()
            elif re.match('^.+@.+$', username):
                user = models.User.objects.filter(email=username).first()
            else:
                user = models.User.objects.filter(username=username).first()
            if user:
                ret = user.check_password(password)
                if ret:
                    return user
                else:
                    raise ValidationError('密码错误')
            else:
                raise ValidationError('用户不存在')

        def _get_token(self, user):
            payload = jwt_payload_handler(user)  # 通过user对象获取payload
            token = jwt_encode_handler(payload)  # 通过payload获取token
            return token

    ```
  2. 在 views里 继承viewset类去写一个login 并且用action赋予post请求
    ```Python
    from django.shortcuts import render
    from rest_framework.viewsets import ViewSet
    from rest_framework.decorators import action
    from luffyapi.utils.luffyresponse import LuffyResponse
    from . import ser


    # Create your views here.

    class LoginViewSet(ViewSet):
        @action(methods=['POST', ], detail=False)
        def login(self, reqeust, *args, **kwargs):
            user_ser = ser.UserModelSerializer(data=reqeust.data, context={})
            if user_ser.is_valid():
                token = user_ser.context['token']
                username = user_ser.context['user'].username

                return LuffyResponse(code=2000, msg='登录成功', token=token, username=username)
            else:
                return LuffyResponse(code=5000, msg=user_ser.errors)
    ```
  3. 在urls里 配置路由
    ```Python
    from django.urls import path, re_path, include
    from rest_framework.routers import SimpleRouter
    from . import views

    router = SimpleRouter()
    router.register('', views.LoginViewSet, 'login')

    urlpatterns = [

    ]
    urlpatterns += router.urls
    ```
- 手机号登录接口
- 发送验证码接口
- 注册接口
- 校验手机号是否存在接口
- 上面5个接口都写在LoginViewSet里 通过@action去配置路由哦
```Python
class LoginViewSet(ViewSet):
    @action(methods=['POST', ], detail=False)
    def login(self, reqeust, *args, **kwargs):
        user_ser = ser.UserModelSerializer(data=reqeust.data, context={})
        if user_ser.is_valid():
            token = user_ser.context['token']
            username = user_ser.context['user'].username

            return LuffyResponse(code=2000, msg='登录成功', token=token, username=username)
        else:
            return LuffyResponse(code=5000, msg=user_ser.errors)

    @action(methods=['get', ], detail=False)
    def check_telephone(self, request, *args, **kwargs):
        telephone = request.query_params.get('telephone')
        if not re.match('^1[3-9][0-9]{9}$', telephone):
            return LuffyResponse(code=0, msg='手机号不合法')
        try:
            user = models.User.objects.get(phone=telephone)
            return LuffyResponse(code=1, data=1)
        except:
            return LuffyResponse(code=0, msg='手机号不存在', data=0)

    @action(methods=['GET', ], detail=False)
    def send_code(self, request, *args, **kwargs):
        # from luffyapi.libs.tx_sms import get_code,send_message
        from django.core.cache import cache
        import random
        telephone = request.query_params.get('telephone')
        if not re.match('^1[3-9][0-9]{9}$', telephone):
            return LuffyResponse(code=0, msg='手机号不合法')

        # s_code = ''
        # for i in range(4):
        #     s_code += str(random.randint(0, 9))
        # # result = send_message(telephone, code)
        result = True
        s_code = '1234'
        # 验证码保存
        cache.set(f'sms_code_cache_{telephone}', s_code, 180)
        if result:
            return LuffyResponse(code=1, msg='验证码发送成功')
        else:
            return LuffyResponse(code=0, msg='验证码发送失败')

```