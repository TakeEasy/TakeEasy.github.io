---
title: 某学城项目(3)
date: 2024-07-22 09:45:53
top_img: 'img/12.png'
cover: 'img/12.png'
categories:
  - Django
tags:
  - django-rest-framework
  - Django
  - 环境配置
---


------
# 前端基本搭建和Git管控代码

## 头部组件
- 导航条每个页面都有 固定 在components 目录下添加Head.vue
    ```vue
    <template>
        <div class="header">
            <div class="slogan">
                <p>老男孩IT教育 | 帮助有志向的年轻人通过努力学习获得体面的工作和生活</p>
            </div>
            <div class="nav">
                <ul class="left-part">
                    <li class="logo">
                        <router-link to="/">
                            <img src="../assets/img/head-logo.svg" alt="">
                        </router-link>
                    </li>
                    <li class="ele">
                        <span @click="goPage('/free-course')" :class="{active: url_path === '/free-course'}">免费课</span>
                    </li>
                    <li class="ele">
                        <span @click="goPage('/actual-course')" :class="{active: url_path === '/actual-course'}">实战课</span>
                    </li>
                    <li class="ele">
                        <span @click="goPage('/light-course')" :class="{active: url_path === '/light-course'}">轻课</span>
                    </li>
                </ul>

                <div class="right-part">
                    <div>
                        <span>登录</span>
                        <span class="line">|</span>
                        <span>注册</span>
                    </div>
                </div>
            </div>
        </div>

    </template>

    <script>

        export default {
            name: "Header",
            data() {
                return {
                    url_path: sessionStorage.url_path || '/',
                }
            },
            methods: {
                goPage(url_path) {
                    // 传入的路由如果不是当前所在路径，就跳转
                    if (this.url_path !== url_path) {
                        this.$router.push(url_path);
                    }
                    sessionStorage.url_path = url_path;
                },
            },
            created() {
                sessionStorage.url_path = this.$route.path;
                this.url_path = this.$route.path;
            }
        }
    </script>

    <style scoped>
        .header {
            background-color: white;
            box-shadow: 0 0 5px 0 #aaa;
        }

        .header:after {
            content: "";
            display: block;
            clear: both;
        }

        .slogan {
            background-color: #eee;
            height: 40px;
        }

        .slogan p {
            width: 1200px;
            margin: 0 auto;
            color: #aaa;
            font-size: 13px;
            line-height: 40px;
        }

        .nav {
            background-color: white;
            user-select: none;
            width: 1200px;
            margin: 0 auto;

        }

        .nav ul {
            padding: 15px 0;
            float: left;
        }

        .nav ul:after {
            clear: both;
            content: '';
            display: block;
        }

        .nav ul li {
            float: left;
        }

        .logo {
            margin-right: 20px;
        }

        .ele {
            margin: 0 20px;
        }

        .ele span {
            display: block;
            font: 15px/36px '微软雅黑';
            border-bottom: 2px solid transparent;
            cursor: pointer;
        }

        .ele span:hover {
            border-bottom-color: orange;
        }

        .ele span.active {
            color: orange;
            border-bottom-color: orange;
        }

        .right-part {
            float: right;
        }

        .right-part .line {
            margin: 0 10px;
        }

        .right-part span {
            line-height: 68px;
            cursor: pointer;
        }
    </style>
    ```

## 尾部组件
- 尾部组件同样每个页面都有 在components目录下添加Footer.vue
    ```vue
    <template>
        <div class="footer">
            <ul>
                <li>关于我们</li>
                <li>联系我们</li>
                <li>商务合作</li>
                <li>帮助中心</li>
                <li>意见反馈</li>
                <li>新手指南</li>
            </ul>
            <p>Copyright © luffycity.com版权所有 | 京ICP备17072161号-1</p>
        </div>
    </template>

    <script>
        export default {
            name: "Footer"
        }
    </script>

    <style scoped>
        .footer {
            width: 100%;
            height: 128px;
            background: #25292e;
            color: #fff;
        }

        .footer ul {
            margin: 0 auto 16px;
            padding-top: 38px;
            width: 810px;
        }

        .footer ul li {
            float: left;
            width: 112px;
            margin: 0 10px;
            text-align: center;
            font-size: 14px;
        }

        .footer ul::after {
            content: "";
            display: block;
            clear: both;
        }

        .footer p {
            text-align: center;
            font-size: 12px;
        }
    </style>
    ```

## 轮播图组件
- 首页轮播图 用elementui里的跑马灯 在components目录下添加Banner.vue
    ```vue
    <template>
        <div name="banner" class="block text-center">
        <el-carousel height="auto" :autoplay="false" v-if="banner_list[0]">
        <el-carousel-item v-for="item in banner_list">
            <!-- <h3 class="small justify-center" text="2xl">{{ item }}</h3> -->
            <!-- <img src="../assets/img/banner1.png"> -->
            <RouterLink :to="item.link">
                <img :src="item.img" :alt="item.name">
            </RouterLink>
        </el-carousel-item>
        </el-carousel>
    </div>
    </template>

    <script>
    import {inject} from 'vue'


    export default {
        name: "Banner",
        data(){
            return {
                banner_list:[],
            }
        },
        created(){
            const $settings=inject("$settings")
            //当banner组件一创建 就向后端发请求 拿轮播图数据
            this.axios.get($settings.base_url+'/home/banner/').then(response=>{
                console.log(response.data)
                this.banner_list=response.data
            }).catch(error=>{})
            
        },
    }
    </script>

    <style scoped>
    .demonstration {
    color: var(--el-text-color-secondary);
    }

    /* .el-carousel__item h3 {
    color: #475669;
    opacity: 0.75;
    line-height: 600px;
    margin: 0;
    text-align: center;
    } */

    .el-carousel__item {
            height: 800px;
            min-width: 1200px;
        }

    .el-carousel__item img {
        height: 800px;
        /*margin-left: 20px;*/
        margin-left: calc(50% - 3840px / 2);
    }

    /* .el-carousel__item:nth-child(2n) {
    background-color: #99a9bf;
    }

    .el-carousel__item:nth-child(2n + 1) {
    background-color: #d3dce6;
    } */
    </style>
    ```
- 展示哪些图片 展示多少 我们通过ajax去后端数据库取 所以先在homeapp里操作
```Python
# 将每个表都要有的字段 我们抽象出来 放到utils下luffymodels.py 里
from django.db import models

class BaseModel(models.Model):
    create_time = models.DateTimeField(auto_now_add=True, verbose_name='创建时间')
    update_time = models.DateTimeField(auto_now=True, create_time='最后更新时间')
    is_delete = models.BooleanField(default=False, verbose_name='是否删除')
    is_show = models.BooleanField(default=True, verbose_name='是否展示')
    display_order = models.IntegerField(verbose_name='展示顺序')

    class Meta:
        abstract = True

# 回到home app下的models.py创建表
from luffyapi.utils.luffymodels import BaseModel

class Banner(BaseModel):
    img = models.ImageField(verbose_name='轮播图片', help_text='图片尺寸必须是:3840*800')
    link = models.CharField(max_length=64, verbose_name='跳转链接')
    info = models.TextField(verbose_name='图片简介')

# 到home app目录下创建drf序列化器 ser.py
from rest_framework import serializers
from . import models


class BannerModelSerializer(serializers.ModelSerializer):
    class Meta:
        model = models.Banner
        fields = ['name', 'link', 'img']

# 到Views里根据需要的接口选择相应的drfView继承使用
from rest_framework.views import APIView
from rest_framework.mixins import ListModelMixin
from rest_framework.generics import GenericAPIView, ListAPIView
from luffyapi.utils.luffylogger import luffy_logger
from luffyapi.utils.luffyresponse import LuffyResponse
from . import models
from . import ser


class BannerView(ListAPIView):
    queryset = models.Banner.objects.filter(is_delete=False, is_show=True).order_by('display_order')[
               :settings.BANNER_COUNTER]  # 可以通过settings 里的配置 来控制轮播图的展示数量
    serializer_class = ser.BannerModelSerializer
class BannerViewSet(GenericViewSet, ListModelMixin): # 使用ViewSet 
    queryset = models.Banner.objects.filter(is_delete=False, is_show=True).order_by('display_order')[
               :settings.BANNER_COUNTER]
    serializer_class = ser.BannerModelSerializer

# 根据继承的View使用不同的路由配置方法 urls.py
from django.urls import path, re_path, include
from rest_framework.routers import SimpleRouter
from . import views

router = SimpleRouter()
router.register('banner2', views.BannerViewSet, 'banner2')

urlpatterns = [
    path('banner/', views.BannerView.as_view()),
    # path('banner2/', views.BannerViewSet.as_view({'get': 'list'})) 这是另一种配置方法
]
urlpatterns += router.urls

```
- 用 axios在created生命周期的时候去后端获取banner数据
- **会遇到跑马灯第一页不显示的问题** 要在跑马灯组件加个v-if判断 等banner_list有值了再开始渲染 代码参照上面banner.vue